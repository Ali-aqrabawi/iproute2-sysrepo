<netnses xmlns="urn:okda:iproute2:ip:netns">
    <netns>
        <name>tc_filter_red</name>
    </netns>
</netnses>
<!--this test filter with classes -->
<links xmlns="urn:okda:iproute2:ip:link">
    <link>
        <name>if_tc_f1</name>
        <type>dummy</type>
        <admin-status>up</admin-status>
    </link>
    <link>
        <name>if_tc_f2</name>
        <type>dummy</type>
        <admin-status>up</admin-status>
    </link>
    <link>
        <name>if_tc_f3</name>
        <type>dummy</type>
        <admin-status>up</admin-status>
    </link>
    <link>
        <name>if_tc_f4</name>
        <type>dummy</type>
        <admin-status>up</admin-status>
    </link>
    <link>
        <name>if_tc_f5_red</name>
        <type>dummy</type>
        <admin-status>up</admin-status>
        <netns>tc_filter_red</netns>
    </link>
</links>
<tc-filters xmlns="urn:okda:iproute2:tc:filter">
    <qdisc-filter>
        <dev>if_tc_f1</dev>
        <parent>8001:</parent>
        <netns>1</netns>
        <rule>
            <pref>20</pref>
            <flower>
                <match>
                    <src_ip>1.1.1.1/32</src_ip>
                </match>
                <classid>8001:20</classid>
                <action>pass</action>
            </flower>
        </rule>
        <rule>
            <pref>30</pref>
            <flower>
                <match>
                    <src_ip>5.5.5.5/32</src_ip>
                </match>
                <classid>8001:30</classid>
                <action>pass</action>
            </flower>
        </rule>
        <rule>
            <pref>40</pref>
            <flower>
                <match>
                    <dst_ip>9.9.9.0/24</dst_ip>
                </match>
                <classid>8001:40</classid>
                <action>pass</action>
            </flower>
        </rule>
    </qdisc-filter>
    <qdisc-filter>
        <dev>if_tc_f2</dev>
        <parent>8002:</parent>
        <netns>1</netns>
        <rule>
            <pref>20</pref>
            <u32>
                <match>
                    <ip>
                        <src>1.1.1.1</src>
                    </ip>
                </match>
                <classid>8002:20</classid>
            </u32>
        </rule>
    </qdisc-filter>
    <dev-filter>
        <dev>if_tc_f4</dev>
        <direction>ingress</direction>
        <netns>1</netns>
        <rule>
            <pref>10</pref>
            <flower>
                <match>
                    <ip_proto>icmp</ip_proto>
                    <src_ip>1.2.1.2/32</src_ip>
                </match>
                <action>pass</action>
            </flower>
        </rule>
        <rule>
            <pref>20</pref>
            <flower>
                <action>drop</action>
            </flower>
        </rule>
    </dev-filter>
    <dev-filter>
        <dev>if_tc_f5_red</dev>
        <direction>ingress</direction>
        <netns>tc_filter_red</netns>
        <rule>
            <pref>101</pref>
            <flower>
                <match>
                    <ip_proto>icmp</ip_proto>
                    <src_ip>11.21.11.21/32</src_ip>
                </match>
                <action>pass</action>
            </flower>
        </rule>
        <rule>
            <pref>201</pref>
            <flower>
                <action>drop</action>
            </flower>
        </rule>
    </dev-filter>
    <shared-block-filter xmlns="urn:okda:iproute2:tc:filter">
        <block>10</block>
        <netns>1</netns>
        <rule>
            <pref>10</pref>
            <flower>
                <action>pass</action>
            </flower>
        </rule>
    </shared-block-filter>
</tc-filters>

<classes xmlns="urn:okda:iproute2:tc:qdisc">
    <class>
        <dev>if_tc_f1</dev>
        <parent>8001:</parent>
        <classid>8001:20</classid>
        <netns>1</netns>
        <htb>
            <rate>20mbit</rate>
        </htb>
    </class>
    <class>
        <dev>if_tc_f1</dev>
        <parent>8001:</parent>
        <classid>8001:30</classid>
        <netns>1</netns>
        <htb>
            <rate>30mbit</rate>
        </htb>
    </class>
    <class>
        <dev>if_tc_f1</dev>
        <parent>8001:</parent>
        <classid>8001:40</classid>
        <netns>1</netns>
        <htb>
            <rate>40mbit</rate>
        </htb>
    </class>
    <class>
        <dev>if_tc_f2</dev>
        <parent>8002:</parent>
        <classid>8002:20</classid>
        <netns>1</netns>
        <htb>
            <rate>20mbit</rate>
        </htb>
    </class>
</classes>

<qdiscs xmlns="urn:okda:iproute2:tc:qdisc">
    <qdisc>
        <dev>if_tc_f1</dev>
        <parent>root</parent>
        <netns>1</netns>
        <handle>8001:</handle>
        <qdisc-kind>htb</qdisc-kind>
    </qdisc>
    <qdisc>
        <dev>if_tc_f1</dev>
        <parent>8001:20</parent>
        <netns>1</netns>
        <qdisc-kind>pfifo</qdisc-kind>
        <fifo-options>
            <limit>1002</limit>
        </fifo-options>
    </qdisc>
    <qdisc>
        <dev>if_tc_f1</dev>
        <parent>8001:30</parent>
        <netns>1</netns>
        <qdisc-kind>pfifo</qdisc-kind>
        <fifo-options>
            <limit>1003</limit>
        </fifo-options>
    </qdisc>
    <qdisc>
        <dev>if_tc_f1</dev>
        <parent>8001:40</parent>
        <netns>1</netns>
        <qdisc-kind>pfifo</qdisc-kind>
        <fifo-options>
            <limit>1004</limit>
        </fifo-options>
    </qdisc>
    <qdisc>
        <dev>if_tc_f2</dev>
        <parent>root</parent>
        <netns>1</netns>
        <handle>8002:</handle>
        <qdisc-kind>htb</qdisc-kind>
    </qdisc>
    <special-qdisc>
        <dev>if_tc_f3</dev>
        <qdisc-kind>clsact</qdisc-kind>
        <netns>1</netns>
        <ingress_block>10</ingress_block>
    </special-qdisc>
    <special-qdisc>
        <dev>if_tc_f4</dev>
        <qdisc-kind>ingress</qdisc-kind>
        <netns>1</netns>
    </special-qdisc>
    <special-qdisc>
        <dev>if_tc_f5_red</dev>
        <qdisc-kind>ingress</qdisc-kind>
        <netns>tc_filter_red</netns>
    </special-qdisc>
</qdiscs>
